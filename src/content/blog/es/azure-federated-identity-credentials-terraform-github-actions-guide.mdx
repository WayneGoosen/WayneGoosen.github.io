---
title: 'Azure Federated Identity: Terraform y GitHub Actions'
description: 'Transición de autenticación vía Service Principal con client secret a usar OpenID Connect'
pubDate: 'May 11 2024'
heroImage: '../../../assets/images/fed-creds-github.png'
category: 'DevOps'
tags:
  - Azure
  - GitHub
  - Terraform
  - GitHub Actions
  - OIDC
language: 'es'
---

Recientemente necesité hacer la transición de autenticación vía Service Principal con un client secret a usar OpenID Connect para acciones de Terraform dentro de algunos workflows de GitHub Actions. Este post es para mostrar lo que necesité cambiar ya que no había una sola fuente de esta información para realizar esta actualización.

## TL;DR

Con un workflow existente de Terraform en GitHub Actions, estos son los cambios clave:

1. **Configurar Federated Identity Credentials en Azure**
2. **Actualizar secretos del repositorio**
3. **Modificar el workflow de GitHub Actions**

## Configuración de Azure

Primero, necesitas configurar las credenciales de identidad federada en Azure para tu Service Principal.

```bash
# Crear la credencial de identidad federada
az ad app federated-credential create \
  --id <app-id> \
  --parameters '{
    "name": "github-federated-credential",
    "issuer": "https://token.actions.githubusercontent.com",
    "subject": "repo:tu-usuario/tu-repositorio:ref:refs/heads/main",
    "description": "Credencial federada para GitHub Actions",
    "audiences": ["api://AzureADTokenExchange"]
  }'
```

## Actualización del Workflow

Aquí está la diferencia principal en el workflow:

### Antes (con client secret):
```yaml
- name: Azure Login
  uses: azure/login@v1
  with:
    creds: ${{ secrets.AZURE_CREDENTIALS }}
```

### Después (con OIDC):
```yaml
- name: Azure Login
  uses: azure/login@v1
  with:
    client-id: ${{ secrets.AZURE_CLIENT_ID }}
    tenant-id: ${{ secrets.AZURE_TENANT_ID }}
    subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
```

## Ventajas de OIDC

- **Seguridad mejorada**: No hay secretos de larga duración
- **Rotación automática**: Los tokens son de corta duración
- **Auditoría mejorada**: Mejor trazabilidad de las acciones

Esta transición mejora significativamente la postura de seguridad de tus pipelines de CI/CD.