---
heroImage: /src/assets/images/tfgithubactions.png
category: CICD
description: >-
  A guide on how to use Azure pipeline parameters as variables for Terraform.
pubDate: 2024-07-16
draft: true
tags:
  - terraform
  - iac
  - azurepipelines
title: >-
  Creating Terraform Variables from Azure Pipeline Parameters or Variables
---

This post showcases how to allow users to set parameters or variables on a pipeline and pass them to Terraform as a variable. It showcases step by step how to achieve this starting with an initial pipeline.

## Terraform source

This is a basic example showing a simple flag to enable/disable creation of a random_id resource. The flag is called is_create_enabled

### main.tf

```yaml
terraform {
  required_providers {
    random = {
      source  = "hashicorp/random"
      version = "~>3.0"
    }
  }

  required_version = ">= 1.1.0"
}

provider "random" {
  # Configuration options
}

resource "random_id" "server" {
  count    = var.is_create_enabled ? 1 : 0
  byte_length = 2
}

resource "
```

### variables.tf

```yaml
variable "is_create_enabled" {
type = boolean
default = false
description = "This flag is to enable/disable creation of resources."
}

variable "resource_group_name" {
type = string
default = false
description = "This is the name for the resource group.."
}
```

# Initial Azure Pipelines Source

```yaml
trigger: none

variables:
  - name: resourceGroupName
    value: 'terraform'

stages:
  - stage: DeployTf
    jobs:
      - job: deploy
        steps:
          - task: TerraformInstaller@1
            displayName: 'Terraform Install'
            inputs:
              terraformVersion: 'latest'

          - task: TerraformTaskV4@4
            displayName: 'Terraform Init'
            inputs:
              provider: 'azurerm'
              command: 'init'
              backendServiceArm: 'global-connection'
              backendAzureRmResourceGroupName: 'tfstate'
              backendAzureRmStorageAccountName: 'tfstate24008'
              backendAzureRmContainerName: 'booltest'
              backendAzureRmKey: 'terraform.tfstate'

          - task: TerraformTaskV4@4
            displayName: 'Terraform Validate'
            inputs:
              provider: 'azurerm'
              command: 'validate'

          - task: TerraformTaskV4@4
            displayName: 'Terraform Plan'
            inputs:
              provider: 'azurerm'
              command: 'plan'
              environmentServiceNameAzureRM: 'global-connection'
              commandOptions: '-out main.tfplan -var is_create_enabled=${{ parameters.isCreateEnabled }}'

          - task: TerraformTaskV4@4
            displayName: 'Terraform Apply'
            inputs:
              command: 'apply'
              provider: 'azurerm'
              workingDirectory: '$(Build.SourcesDirectory)'
              environmentServiceNameAzureRM: 'global-connection'
              commandOptions: '-auto-approve -input=false main.tfplan'
```

## Boolean Terraform Variables

Below shows the additions to the terraform source.

### variables.tf

```yaml
variable "is_create_enabled" {
type = boolean
default = false
description = "This flag is to enable/disable creation of resources."
}
```

### main.tf

```yaml
parameters:
  - name: isCreateEnabled
    type: boolean
    default: false
```

and

```yaml
- task: TerraformTaskV4@4
  displayName: 'Terraform Plan'
  inputs:
    provider: 'azurerm'
    command: 'plan'
    environmentServiceNameAzureRM: 'global-connection'
    commandOptions: '-out main.tfplan -var is_create_enabled=${{ parameters.isCreateEnabled }}'
```

When triggering the initial pipeline manually, you will be faced with the following error:

![Terraform Bool Fail Error](/src/assets/images/terraform-bool-fail.png)

The error message 'a bool is required; to convert from string, use lowercase "false"' gives us a good indication on where the error comes from. Lets add a simple task to show what the string value of isCreateEnabled is :

```yaml
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      echo "Boolean value is: ${{ parameters.isCreateEnabled }}"
```

The output is:
'Boolean value is: False'
