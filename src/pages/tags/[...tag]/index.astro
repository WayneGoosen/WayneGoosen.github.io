---
import BaseLayout from '@/layouts/BaseLayout'
import ListPosts from '@/components/ListPosts'
import TitlePage from '@/components/TitlePage'
import { getTags, getPostByTag } from '@/utils'
import { siteConfig } from '@/data/site.config'

export async function getStaticPaths() {
	const tags = await getTags()

	return tags.map((tag) => ({
		params: { tag },
		props: { tag }
	}))
}

const { tag } = Astro.props

const posts = await getPostByTag(tag)

// Get the selected language from the URL
const url = new URL(Astro.url.href)
const selectedLanguage = url.pathname.split('/')[1] || siteConfig.defaultLanguage

// Filter posts by the selected language
const filteredPosts = posts.filter(post => post.data.language === selectedLanguage)
---

<BaseLayout
	title={tag}
	description={`See all blog posts with the following tag: ${tag}`}
	isNoIndex={true}
>
	<TitlePage title={tag} />
	<ListPosts posts={filteredPosts} />
</BaseLayout>
